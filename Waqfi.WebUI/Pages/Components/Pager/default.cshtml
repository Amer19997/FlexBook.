@using Microsoft.AspNetCore.Http.Extensions
@using Microsoft.AspNetCore.WebUtilities
@using WebUI.Helpers
@model Pagination

@{
    var routeUrl = Url.RouteUrl(ViewContext.RouteData.Values);
    var queryStrings = ViewContext.HttpContext.Request.QueryString.Value;

    //Remove P queryString
    var query = QueryHelpers.ParseQuery(queryStrings);
    var items = query.SelectMany(x => x.Value, (col, value) => new KeyValuePair<string, string>(col.Key, value)).ToList();
    items.RemoveAll(x => x.Key == "p");
    var querybuilder = new QueryBuilder(items);

    //after remove
    queryStrings = querybuilder.ToQueryString().Value;

    if (string.IsNullOrWhiteSpace(queryStrings))
        queryStrings = "?p=";
    else
        queryStrings += "&p=";

    //final url
    var returnUrl = $"{routeUrl}{queryStrings}";
}

@if (Model?.TotalPages > 1)
{
    <form method="post"
      data-ajax="true"
      data-ajax-url="?handler=Search"
      data-ajax-method="post"
      id="pagination-form"
      data-ajax-mode="replace"
      data-ajax-update="#search-result">
    
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">

                <li class="page-item">
                    @if (Model.CurrentPage <= 1)
                    {
                        <div class="d-flex justify-content-between">
                            <button class="page-link ms-2" type="submit" name="p" value="1">
                                <img src="~/cms_lib/img/icons/group 48646.svg" class="arrow-icon rotated" alt="arrow-right" />
                            </button>
                            <button class="page-link ms-2" type="button" tabindex="-1">
                                <img src="~/cms_lib/img/icons/Arrow-rightSquareDeactive.svg" class="arrow-icon rotated" alt="arrow-right" />
                            </button>
                           

                       </div>

                    }
                    else
                    {
                      



                        <div class="d-flex justify-content-between">
                            <button class="page-link ms-2" type="submit" name="p" value="1">
                                <img src="~/cms_lib/img/icons/group 48645.svg" class="arrow-icon rotated" alt="arrow-right" />
                            </button>
                            <button class="page-link ms-2" type="submit" name="p" value="@(Model.CurrentPage - 1)">
                                <img src="~/cms_lib/img/icons/Arrow-rightSquare.svg" class="arrow-icon rotated" alt="arrow-right" />
                             </button>

                         
                        </div>
                       
                    }
                    
               
            </li>

            @foreach (var p in Model.Pages)
            {
                    if (p == -1)
                    {
                        <li class="page-item" >...</li>
                        continue;
                    }
                    <li class="page-item @(p == Model.CurrentPage ? "active" : "")" id="@(p == Model.CurrentPage ? "currentPageNumber" : "")">
                        <button class="page-link" type="submit" name="p" value="@p">@p</button>
                       
                </li>
            }

                

            <li class="page-item ">
                    @if (Model.CurrentPage >= Model.TotalPages)
                    {
                        <div class="d-flex justify-content-between">
                            <button class="page-link ms-2" type="button">
                            <img src="~/cms_lib/img/icons/Arrow-LeftSquareDeactive.svg" class="arrow-icon rotated" alt="arrow-left" />
                         </button>
                            <button class="page-link" type="submit" name="p" value="@(Model.TotalPages)">
                                <img src="~/cms_lib/img/icons/group 48647.svg" class="arrow-icon rotated" alt="arrow-left" />
                        </button>
                      </div>
                    }
                    else
                    {
                         <div class="d-flex justify-content-between">
                            <button class="page-link ms-2" type="submit" name="p" value="@(Model.CurrentPage + 1)">
                                <img src="~/cms_lib/img/icons/Arrow-LeftSquare.svg" class="arrow-icon rotated" alt="arrow-left" />
                        </button>
                            <button class="page-link" type="submit" name="p" value="@(Model.TotalPages)">
                                <img src="~/cms_lib/img/icons/group 48644.svg" class="arrow-icon rotated" alt="arrow-left" />
                        </button>
                        </div>
                    }
                   
                
            </li>

        </ul>

    </nav>
    </form>
}
