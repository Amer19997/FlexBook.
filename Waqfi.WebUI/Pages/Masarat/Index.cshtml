@page
@using WebUI.IntegrationServices;
@model WebUI.Pages.Masarat.IndexModel
@{

    var i = (Model.PageNumber * Model.PageSize) - Model.PageSize + 1;
}

@Html.AntiForgeryToken()
@if (!string.IsNullOrEmpty(Model.Error))
{
    <span style="color:red"> . @Model.Error</span>

    <br />
}
@if (Model.MasaratListResults.Any())
{
    <div class="col-12">
        <!--strat table -->
        <div class="app-table table-responsive">

            <div class="app-heading d-flex justify-content-between">
                <div class="app-title">

                    <h3 class="m-0">إدارة المسارات </h3>
                </div>
                @if (User.IsInRole(SystemRoles.ViewMasaratList)|| User.IsInRole(SystemRoles.SuperAdmin))
                {
                    <div class="app-heading-end d-flex w-50 justify-content-end">
                        <a class="btn btn-tertiary line-befor me-5" href="/Masarat/AddMasaratItem">
                            اضف مسار جديد
                        </a>
                    </div>
                }
            </div>

            <table id="Questiontable" class="table fagtable table-bordered">
                <thead>
                    <tr class="table-header">
                        <th scope="col">م</th>
                        <th scope="col">ايقونة العرض </th>
                        <th scope="col"> اسم المسار </th>
                        @*                        <th scope="col"> الوصف  </th>                    *@
                        <th scope="col"> المنتجات</th>
                        <th scope="col"> الإجراء</th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var item in Model.MasaratListResults)
                    {
                        <tr>
                            <td>@(i++)</td>
                            <td><img style="background-color:black; width:50px" loading="lazy" src="@item.IconUrl">  </td>
                            <td>@item.NameAr</td>
                            @*                            <td>@item.DiscriptionAr</td>*@
                            <td>@item.NumebrOfItems</td>
                            <td>
                                <div class="controls">

                                    <ul>
                                        @if (User.IsInRole(SystemRoles.ViewMasaratList) || User.IsInRole(SystemRoles.SuperAdmin))
                                        {
                                            <li>

                                                <a href="/Masarat/MasaratDetails?MasaratId=@item.Id"><img src="~/cms_lib/img/icons/document.svg" /></a>

                                            </li>
                                        }
                                        @if (User.IsInRole(SystemRoles.ViewMasaratList) || User.IsInRole(SystemRoles.SuperAdmin))
                                        {
                                            <li>

                                                <a href="/Masarat/EditMasaratItem?id=@item.Id"><img src="~/cms_lib/img/icons/Edit.svg" /></a>

                                            </li>
                                        }
                                        @if (User.IsInRole(SystemRoles.ViewMasaratList) || User.IsInRole(SystemRoles.SuperAdmin))
                                        {
                                            <li>
                                                <button class="DeleteMassar" data-id="@item.Id">
                                                    <img src="~/cms_lib/img/icons/Delete.svg" />
                                                </button>


                                            </li>
                                        }
                                    </ul>
                                </div>
                            </td>
                        </tr>

                    }



                </tbody>
            </table>


        </div>

    </div>
}
else
{

    <div class="parent w-100 h-100">
        <div class="child">
            <div>
                <img src="~/Cms_Lib/img/icons/no-users-icon.svg" alt="search-icon" />

            </div>

            <div>
                <h2>لا يوجد مسار</h2>

            </div>
            @if (User.IsInRole(SystemRoles.ViewMasaratList) || User.IsInRole(SystemRoles.SuperAdmin))
            {
                <a href="/Masarat/AddMasaratItem" class="btn btn-tertiary">
                    <img src="~/Cms_Lib/img/icons/add-user.svg" alt="search-icon" />
                    إضافة مسار جديد
                </a>
            }
        </div>

    </div>
}



<div class="modal fade body-modal" id="Delete-Masar-Modal" data-bs-backdrop="static" data-bs-keyboard="false"
     tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content text-center">
            <div class="modal-body">
                <span class="ps-1"><img src="/cms_lib/img/icons/deactive.svg" alt="details-icon" class="icons" /></span>
                <h3>هل تريد حذف هذا المسار؟ </h3>
                <p>في حالة الموافقة على الحذف لن تستطيع استعادة هذه البيانات مرة أخرى </p>

            </div>
            <div class="modal-button">
                <a id="Delete-Modal" data-id="" class=" btn btn-tertiary">نعم</a>
                <button class=" btn btn-light-primary" data-bs-dismiss="modal">لا</button>
            </div>


        </div>
    </div>
</div>
<div class="modal fade body-modal" id="DeleteFailed" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content text-center">
            <div class="modal-body text-center">
                <span class="ps-1"><img src="~/cms_lib/img/icons/warning-popup.svg" alt="details-icon" class="icons" /></span>
                <h3 id="MessageFail"></h3>

            </div>

        </div>
    </div>
</div>

<div class="modal fade body-modal" id="DeleteSuccess" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content text-center">
            <div class="modal-body text-center">
                <span class="ps-1"><img src="~/Cms_Lib/img/icons/add-user-popup.svg" alt="details-icon" class="icons" /></span>
                <h3 id="MessageSuccess"></h3>

            </div>

        </div>
    </div>
</div>

<div class="app-pagination">
    <vc:pager total-items-count="@Model.TotalCount" current-page="@Model.PageNumber ?? 1">

    </vc:pager>

</div>


@section scripts {

    <script>
        $(document).on("click", ".DeleteMassar", function () {

            var GetMasarId = $(this).attr("data-id");
            $('#Delete-Modal').attr("data-id", GetMasarId);
            $('#Delete-Masar-Modal').modal('show');
        });

        $(document).on("click", "#Delete-Modal", function () {

            var GetMasarId = $(this).attr("data-id");
            DeleteMasarat(GetMasarId);
        });

        function DeleteMasarat(GetVal) {

            $.ajax({
                url: "?handler=DeleteMasar",
                type: "Post",
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                data: { "MasarId": GetVal },
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function (result) {

                    var IfSucces = result.errors;
                    if (IfSucces.length > 0) {

                        $('#Delete-Masar-Modal').modal('hide');

                        $('#MessageFail').text(result.errors)

                        $(function () {
                            $('#DeleteFailed').modal('show');
                        })

                        setTimeout(function () {
                            $('#DeleteFailed').modal('hide');
                        }, 3000);
                    } else {

                        $('#Delete-Masar-Modal').modal('hide');

                        $('#MessageSuccess').text('تم حذف المسار بنجاح')

                        $(function () {
                            $('#DeleteSuccess').modal('show');
                        })

                        setTimeout(function () {
                            $('#DeleteSuccess').modal('hide');
                            window.location.href = "/Masarat/Index";
                        }, 3000);





                    }

                }
            });
        }




    </script>

}